ip addr add dev eth0 10.0.0.132/28
ip link set dev eth0 up

ip addr add dev eth1 10.0.0.145/28
ip link set dev eth1 up

ip addr add dev eth2 10.0.2.65/30
ip link set dev eth2 up

ip addr add dev eth3 10.0.2.69/30
ip link set dev eth3 up

ip addr add dev eth4 10.0.0.17/30
ip link set dev eth4 up

ip addr add dev eth5 192.168.0.3/29
ip link set dev eth5 up

ip route add 10.0.0.0/28 via 10.0.0.18
ip route add 0.0.0.0/0 via 10.0.0.18
ip route add 10.0.2.72/29 via 10.0.0.130

/etc/init.d/zebra start
/etc/init.d/snmpd start
/etc/init.d/dhcp3-server start


##FIREWALL


iptables -P INPUT ACCEPT
iptables -P OUTPUT ACCEPT
iptables -P FORWARD ACCEPT

iptables --flush

iptables -A FORWARD -i eth4 -m state --state ESTABLISHED,RELATED -j ACCEPT #garantir que quando temos conexao ha resposta#


# HTTP 
iptables -A FORWARD -i eth4 -p tcp -d 10.0.0.130 --dport 80 -j ACCEPT
iptables -A FORWARD -i eth4 -p udp -d 10.0.0.130 --dport 80 -j ACCEPT



#HTTPs
iptables -A FORWARD -i eth4 -p tcp -d 10.0.0.130 --dport 443 -j ACCEPT
iptables -A FORWARD -i eth4 -p udp -d 10.0.0.130 --dport 443 -j ACCEPT



# SSH
iptables -A FORWARD -i eth4 -p tcp -d 10.0.0.131 --dport 22 -j ACCEPT
iptables -A FORWARD -i eth4 -p udp -d 10.0.0.131 --dport 22 -j ACCEPT

iptables -A FORWARD -i eth4 -p tcp -d 10.0.0.130 --dport 22 -j ACCEPT
iptables -A FORWARD -i eth4 -p udp -d 10.0.0.130 --dport 22 -j ACCEPT

iptables -A FORWARD -i eth4 -p tcp -d 10.0.0.129 --dport 22 -j ACCEPT
iptables -A FORWARD -i eth4 -p udp -d 10.0.0.129 --dport 22 -j ACCEPT


#IMAP
iptables -A FORWARD -i eth4 -p udp -d 10.0.0.129 --dport 25 -j ACCEPT
iptables -A FORWARD -i eth4 -p tcp -d 10.0.0.129 --dport 25 -j ACCEPT

#SMTP
iptables -A FORWARD -i eth4 -p tcp -d 10.0.0.129 --dport 143 -j ACCEPT

#DNS 
iptables -A FORWARD -i eth4 -p udp -d 10.0.0.129 --dport 53 -j ACCEPT
iptables -A FORWARD -i eth4 -p tcp -d 10.0.0.129 --dport 53 -j ACCEPT
iptables -A FORWARD -i eth4 -p udp -d 10.0.0.130 --dport 53 -j ACCEPT
iptables -A FORWARD -i eth4 -p tcp -d 10.0.0.130 --dport 53 -j ACCEPT

#VPN
iptables -A FORWARD -i eth4 -p tcp -d 10.0.0.130 --dport 1194 -j ACCEPT
iptables -A FORWARD -i eth4 -p udp -d 10.0.0.130 --dport 1194 -j ACCEPT

#Proxy

iptables -t nat -A PREROUTING -p tcp -s 10.0.0.160/27  --dport 80 -d 10.0.0.130 -j DNAT --to-destination 10.0.0.131:3128
iptables -t nat -A PREROUTING -p udp -s 10.0.0.160/27  --dport 80 -d 10.0.0.130 -j DNAT --to-destination 10.0.0.131:3128
iptables -t nat -A PREROUTING -p udp -s 10.0.0.128/26  --dport 80 -o eth4 -j DNAT --to-destination 10.0.0.131:3128

#iptables -t nat -A PREROUTING -p tcp -s 10.0.0.160/28  --dport 80 -j DNAT --to-destination 10.0.0.131:3128
#iptables -t nat -A PREROUTING -p tcp -s 10.0.0.176/28  --dport 80 -j DNAT --to-destination 10.0.0.131:3128
#iptables -t nat -A PREROUTING -p tcp -s 10.0.0.144/28  --dport 80 -j DNAT --to-destination 10.0.0.131:3128
#iptables -t nat -A PREROUTING -p tcp -s 10.0.2.64/28   --dport 80 -j DNAT --to-destination 10.0.0.131:3128
#iptables -t nat -A PREROUTING -p tcp -s 10.0.0.129	   --dport 80 -j DNAT --to-destination 10.0.0.131:3128
#iptables -t nat -A PREROUTING -p tcp -s 10.0.0.130 	   --dport 80 -j DNAT --to-destination 10.0.0.131:3128

#iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 3128

#iptables -A POSTROUTING -s 10.0.0.160/28 -j MASQUERADE COMMIT
#iptables -A POSTROUTING -s 10.0.0.176/28 -j MASQUERADE COMMIT
#iptables -A POSTROUTING -s 10.0.0.144/28 -j MASQUERADE COMMIT
#iptables -A POSTROUTING -s 10.0.2.64/28 -j MASQUERADE COMMIT


#GUESTS
iptables -A FORWARD -d 10.0.0.160/28 -j ACCEPT
iptables -A FORWARD -d 10.0.0.176/28 -j ACCEPT

iptables -A FORWARD -s 10.0.0.128/28 -o eth4 -j ACCEPT

iptables -A FORWARD -i eth4 -j DROP
iptables -A FORWARD -o eth4 -j DROP

iptables -A FORWARD -p tcp 10.0.0.130 --dport 80 -j DROP
iptables -A FORWARD -p udp 10.0.0.130 --dport 80 -j DROP



